<!--
  File: index.html
  Path: index.html
  Description: App entry HTML with Boot Error Overlay, Boot Resource Map,
               bootDebug, NetworkLogger, PlayerLogger, and React mount point.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MyTube</title>

    <!-- ------------------------------------------------------------
         BOOT ERROR OVERLAY (runs BEFORE React, BEFORE main.jsx)
         Captures:
         - Missing scripts (404)
         - Syntax errors
         - Promise rejections
         - Any boot failure that prevents React from mounting
    ------------------------------------------------------------- -->
    <script>
      (function () {
        const overlay = document.createElement("div");
        overlay.id = "boot-error-overlay";
        overlay.style.position = "fixed";
        overlay.style.top = "0";
        overlay.style.left = "0";
        overlay.style.right = "0";
        overlay.style.bottom = "0";
        overlay.style.background = "rgba(0,0,0,0.92)";
        overlay.style.color = "#ff4444";
        overlay.style.fontFamily = "monospace";
        overlay.style.fontSize = "14px";
        overlay.style.padding = "20px";
        overlay.style.zIndex = "999999999";
        overlay.style.overflowY = "auto";
        overlay.style.whiteSpace = "pre-wrap";
        overlay.style.display = "none";
        document.body.appendChild(overlay);

        function showError(msg) {
          overlay.style.display = "block";
          overlay.innerText += msg + "\n";
        }

        // JS errors
        window.addEventListener("error", (e) => {
          showError("BOOT ERROR → " + e.message);
        });

        // Promise rejections
        window.addEventListener("unhandledrejection", (e) => {
          showError("BOOT PROMISE → " + (e.reason?.message || e.reason));
        });

        // Missing resources (404)
        window.addEventListener(
          "error",
          (e) => {
            if (e.target && (e.target.src || e.target.href)) {
              showError("RESOURCE 404 → " + (e.target.src || e.target.href));
            }
          },
          true
        );

        window.__bootErrorOverlay = { showError };
      })();
    </script>

    <!-- ------------------------------------------------------------
         BOOT RESOURCE MAP
         Logs every script, stylesheet, image, and fetch() load attempt.
         Runs BEFORE React, BEFORE main.jsx, BEFORE bootDebug.
    ------------------------------------------------------------- -->
    <script>
      (function () {
        const overlay = document.getElementById("boot-error-overlay");

        function log(msg) {
          overlay.style.display = "block";
          overlay.innerText += msg + "\n";
        }

        // Track successful loads
        document.addEventListener(
          "load",
          (e) => {
            const el = e.target;
            if (el.tagName === "SCRIPT") log("RESOURCE OK → script loaded: " + (el.src || "[inline]"));
            if (el.tagName === "LINK") log("RESOURCE OK → stylesheet loaded: " + el.href);
            if (el.tagName === "IMG") log("RESOURCE OK → image loaded: " + el.src);
          },
          true
        );

        // Track failed loads
        document.addEventListener(
          "error",
          (e) => {
            const el = e.target;
            if (el.tagName === "SCRIPT") log("RESOURCE FAIL → script failed: " + (el.src || "[inline]"));
            if (el.tagName === "LINK") log("RESOURCE FAIL → stylesheet failed: " + el.href);
            if (el.tagName === "IMG") log("RESOURCE FAIL → image failed: " + el.src);
          },
          true
        );

        // Intercept fetch() during boot
        const originalFetch = window.fetch;
        window.fetch = async function (...args) {
          const url = args[0];
          try {
            const res = await originalFetch(...args);
            if (!res.ok) {
              log("FETCH FAIL → " + url + " | status=" + res.status);
            } else {
              log("FETCH OK → " + url + " | status=" + res.status);
            }
            return res;
          } catch (err) {
            log("FETCH ERROR → " + url + " | " + err.message);
            throw err;
          }
        };
      })();
    </script>
  </head>

  <body style="margin:0; background:black;">
    <!-- React root -->
    <div id="root"></div>

    <!-- ------------------------------------------------------------
         BOOT DEBUG + NETWORK LOGGER + PLAYER LOGGER
         Must load BEFORE main.jsx
    ------------------------------------------------------------- -->
    <script type="module">
      import "/src/debug/bootDebug.js";
      import { installNetworkLogger } from "/src/debug/NetworkLogger.js";
      import { installPlayerLogger } from "/src/debug/PlayerLogger.js";

      installNetworkLogger();
      installPlayerLogger();
    </script>

    <!-- ------------------------------------------------------------
         MAIN REACT ENTRY
    ------------------------------------------------------------- -->
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
