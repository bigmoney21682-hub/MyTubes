<!--
  File: index.html
  Path: public/index.html
  Description:
    Main HTML entry point for MyTube.
    Includes safe, nonâ€‘blocking boot error overlay,
    YouTube IFrame API, and Vite entry point.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyTube</title>

    <link
      rel="icon"
      type="image/png"
      href="/MyTube-Piped-Frontend/favicon.png"
    />
  </head>

  <body>
    <!-- React root -->
    <div id="root"></div>

    <!--
      File: index.html (Boot Error Overlay Patch)
      Path: public/index.html
      Description:
        Safe, nonâ€‘blocking boot error overlay.
        Logs bootâ€‘time errors without preventing React or playback.
    -->

    <!-- Boot error overlay (enhanced version) -->
    <script>
      (function () {
        const overlay = document.createElement("div");
        overlay.id = "boot-error-overlay";

        Object.assign(overlay.style, {
          position: "fixed",
          top: "0",
          left: "0",
          right: "0",
          bottom: "0",
          background: "rgba(0,0,0,0.92)",
          color: "#ff4444",
          fontFamily: "monospace",
          fontSize: "14px",
          padding: "20px",
          zIndex: "2147483647",
          overflowY: "auto",
          whiteSpace: "pre-wrap",
          display: "none",
          pointerEvents: "auto"
        });

        document.body.appendChild(overlay);

        function makeButton(label, rightOffset, onClick) {
          const btn = document.createElement("button");
          btn.innerText = label;

          Object.assign(btn.style, {
            position: "absolute",
            top: "10px",
            right: rightOffset,
            padding: "6px 12px",
            background: "#444",
            color: "#fff",
            border: "1px solid #666",
            borderRadius: "4px",
            cursor: "pointer",
            zIndex: "2147483647",
            pointerEvents: "auto"
          });

          btn.onclick = onClick;
          overlay.appendChild(btn);
        }

        makeButton("Continue", "10px", () => {
          overlay.style.display = "none";
        });

        makeButton("Copy Logs", "110px", () => {
          navigator.clipboard.writeText(overlay.innerText);
        });

        function showError(msg) {
          overlay.style.display = "block";
          overlay.innerText += msg + "\n";

          // Never block boot â€” always allow React to mount
          window.__BOOT_READY = true;
        }

        // ðŸ”¥ Enhanced global error handler
        window.addEventListener("error", (e) => {
          try {
            const msg = [
              "BOOT ERROR â†’ [GLOBAL]",
              "message: " + e.message,
              "filename: " + e.filename,
              "lineno: " + e.lineno,
              "colno: " + e.colno,
              "stack: " + (e.error && e.error.stack)
            ].join("\n");

            showError(msg + "\n");
          } catch (err) {
            showError(
              "BOOT ERROR â†’ [GLOBAL] (handler failure): " + String(err) + "\n"
            );
          }
        });

        // ðŸ”¥ Enhanced unhandled rejection handler
        window.addEventListener("unhandledrejection", (e) => {
          try {
            const reason = e.reason;
            const msg = [
              "BOOT PROMISE â†’ [GLOBAL]",
              "message: " +
                (reason && reason.message ? reason.message : String(reason)),
              "stack: " + (reason && reason.stack)
            ].join("\n");

            showError(msg + "\n");
          } catch (err) {
            showError(
              "BOOT PROMISE â†’ [GLOBAL] (handler failure): " +
                String(err) +
                "\n"
            );
          }
        });

        window.__bootErrorOverlay = { showError };
      })();
    </script>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <!-- Vite entry point (CRITICAL) -->
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
