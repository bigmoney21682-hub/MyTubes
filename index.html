<!--
  File: index.html
  Path: index.html
  Description: App entry HTML with Boot Error Overlay, Boot Resource Map,
               debug-boot.js, YouTube API, and React mount point.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MyTube</title>
  </head>

  <body style="margin:0; background:black;">
    <!-- React root -->
    <div id="root"></div>

    <!-- ------------------------------------------------------------
         GLOBAL YOUTUBE PLAYER (hidden iframe mount point)
    ------------------------------------------------------------- -->
    <div
      id="global-player"
      style="
        position: fixed;
        width: 0;
        height: 0;
        opacity: 0;
        pointer-events: none;
        z-index: -1;
      "
    ></div>

    <!-- ------------------------------------------------------------
         YOUTUBE IFRAME API
    ------------------------------------------------------------- -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <!-- ------------------------------------------------------------
         BOOT ERROR OVERLAY
    ------------------------------------------------------------- -->
    <script>
      (function () {
        const overlay = document.createElement("div");
        overlay.id = "boot-error-overlay";
        overlay.style.position = "fixed";
        overlay.style.top = "0";
        overlay.style.left = "0";
        overlay.style.right = "0";
        overlay.style.bottom = "0";
        overlay.style.background = "rgba(0,0,0,0.92)";
        overlay.style.color = "#ff4444";
        overlay.style.fontFamily = "monospace";
        overlay.style.fontSize = "14px";
        overlay.style.padding = "20px";
        overlay.style.zIndex = "999999999";
        overlay.style.overflowY = "auto";
        overlay.style.whiteSpace = "pre-wrap";
        overlay.style.display = "none";
        document.body.appendChild(overlay);

        function showError(msg) {
          overlay.style.display = "block";
          overlay.innerText += msg + "\n";
        }

        window.addEventListener("error", (e) => {
          showError("BOOT ERROR â†’ " + e.message);
        });

        window.addEventListener("unhandledrejection", (e) => {
          showError("BOOT PROMISE â†’ " + (e.reason?.message || e.reason));
        });

        window.addEventListener(
          "error",
          (e) => {
            if (e.target && (e.target.src || e.target.href)) {
              showError("RESOURCE 404 â†’ " + (e.target.src || e.target.href));
            }
          },
          true
        );

        window.__bootErrorOverlay = { showError };
      })();
    </script>

    <!-- ------------------------------------------------------------
         BOOT RESOURCE MAP
    ------------------------------------------------------------- -->
    <script>
      (function () {
        const overlay = document.getElementById("boot-error-overlay");

        function log(msg) {
          overlay.style.display = "block";
          overlay.innerText += msg + "\n";
        }

        document.addEventListener(
          "load",
          (e) => {
            const el = e.target;
            if (el.tagName === "SCRIPT") log("RESOURCE OK â†’ script loaded: " + (el.src || "[inline]"));
            if (el.tagName === "LINK") log("RESOURCE OK â†’ stylesheet loaded: " + el.href);
            if (el.tagName === "IMG") log("RESOURCE OK â†’ image loaded: " + el.src);
          },
          true
        );

        document.addEventListener(
          "error",
          (e) => {
            const el = e.target;
            if (el.tagName === "SCRIPT") log("RESOURCE FAIL â†’ script failed: " + (el.src || "[inline]"));
            if (el.tagName === "LINK") log("RESOURCE FAIL â†’ stylesheet failed: " + el.href);
            if (el.tagName === "IMG") log("RESOURCE FAIL â†’ image failed: " + el.src);
          },
          true
        );

        const originalFetch = window.fetch;
        window.fetch = async function (...args) {
          const url = args[0];
          try {
            const res = await originalFetch(...args);
            if (!res.ok) {
              log("FETCH FAIL â†’ " + url + " | status=" + res.status);
            } else {
              log("FETCH OK â†’ " + url + " | status=" + res.status);
            }
            return res;
          } catch (err) {
            log("FETCH ERROR â†’ " + url + " | " + err.message);
            throw err;
          }
        };

        // ðŸ”¥ Auto-hide overlay when app signals ready
        const readyCheck = setInterval(() => {
          if (window.__BOOT_READY) {
            overlay.style.display = "none";
            clearInterval(readyCheck);
          }
        }, 300);
      })();
    </script>

    <!-- ------------------------------------------------------------
         BOOT LOGGER (public/debug-boot.js)
         Must load BEFORE Vite bundle.
    ------------------------------------------------------------- -->
    <script src="/MyTube-Piped-Frontend/debug-boot.js"></script>

    <!-- ------------------------------------------------------------
         MAIN VITE BUNDLE (injected automatically in production)
         DO NOT import /src/... here.
         Vite will replace this with:
         <script type="module" crossorigin src="/MyTube-Piped-Frontend/assets/index-xxxx.js"></script>
    ------------------------------------------------------------- -->
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
